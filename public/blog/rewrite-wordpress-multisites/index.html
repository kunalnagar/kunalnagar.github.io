<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kunal Nagar</title>
	<meta name="robots" content="index, follow">
	
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

	
<style>
      	body{font-family:"Open Sans",sans-serif}.kunal{max-width:850px;margin:0 auto}.emoji{margin-right:.5em}.header .header__heading{margin-bottom:0}.header .header__emoji{font-size:.8em}.header .header__link-home{color:#000;vertical-align:middle}a{color:#1327f0;text-decoration:none}
      </style>
      <script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-51202219-2', 'auto');
ga('send', 'pageview');
</script>
<script async src="//www.google-analytics.com/analytics.js"></script>

</head>
<body>
	<main class="kunal">
		<div class="container">
	<section class="header">
		<h2 class="header__heading">
			<span class="emoji header__emoji">üè†</span><a id="btn_link_home" href="/" class="header__link-home">Kunal Nagar</a>
		</h2>
		<hr>
	</section>
</div>
		
	<section>
		<h3>Rewrite WordPress Multisites</h3>
		<article>
			

<p>Recently, one of my tasks was to create a Blog and a Knowledge Base and use similar credentials and login-flows for both of their Admin Consoles. Without a doubt, <a href="https://codex.wordpress.org/Create_A_Network">WordPress Multisite</a> is the perfect choice for this since you don&rsquo;t have to manage your Auth/Settings/Dashboard in multiple places.</p>

<p><i><b>Note:</b> Creating WordPress multisites is out of the scope of this article. For more info, check out <a href="https://codex.wordpress.org/Create_A_Network">this link</a>.</i></p>

<p>When you set up a WordPress Multisite install, you create one root site and then all other multisites are created as subfolders (children). For example, you may end up with something like:</p>

<pre><code class="shell">
http://localhost/blog/ # Root Site
http://localhost/blog/knowledgebase/ # Multisite 1
http://localhost/blog/site/ # Multisite 2
</code></pre>

<p>As you can see, this is not ideal, you would ideally want something like this, i.e. each multisite at the same level as the root site (blog):</p>

<pre><code class="shell">
http://localhost/blog/
http://localhost/knowledgebase/
http://localhost/site/
</code></pre>

<p>It turns out ‚Äì you can easily do this in 3 steps:</p>

<h4 id="step-1-create-a-root-level-htaccess">Step 1: Create a root level .htaccess</h4>

<p>We need to intercept all request to multisites and then rewrite them to their original URLs.</p>

<p>Please note that this is NOT a redirect, but a rewrite. There&rsquo;s a <a href="http://weblogs.asp.net/owscott/rewrite-vs-redirect-what-s-the-difference">difference</a>.</p>

<p>Moving along ‚Äì create an .htaccess file in the root. If you&rsquo;re using something like XAMPP, create it in the <b>htdocs</b> folder:</p>

<pre><code class="shell">
# Root Level .htaccess

RewriteEngine On
RewriteBase /

# Redirect knowledgebase to knowledgebase/
RewriteRule knowledgebase$ knowledgebase/ [R=301,L]

# Intercept all requests coming to http://localhost/knowledgebase
RewriteCond %{REQUEST_URI} /knowledgebase

# Rewrite the intercepted requests to
# /knowledgebase/anything-here from /blog/knowledgebase/anything-here
RewriteRule ^knowledgebase/(.*) blog/knowledgebase/$1 [L]
</code></pre>

<h4 id="step-2-update-the-database">Step 2: Update the Database</h4>

<p>Just rewriting in the <b>.htaccess</b> is not going to cut it for us. There are some entries in the Database that we need to change:</p>

<pre><code class="sql">
-- Update wp_blogs table to remove /blog from the path
UPDATE wp_blogs SET path="/knowledgebase/" WHERE path="/blog/knowledgebase/";

-- Update wp_SITE_ID_options siteurl to remove /blog in the URL
UPDATE wp_2_options SET option_value="http://localhost/knowledgebase" WHERE option_name="siteurl";

-- Update wp_SITE_ID_options home to remove /blog in the URL
UPDATE wp_2_options SET option_value="http://localhost/knowledgebase" WHERE option_name="home";
</code></pre>

<h4 id="step-3-handle-cookies-sessions">Step 3: Handle cookies/sessions</h4>

<p>Now, we need to handle cookies/sessions since our URLs have changed. Paste the following lines in the <b>wp-config.php</b> file below the multisite lines:</p>

<pre><code class="php">
define('ADMIN_COOKIE_PATH', '/');
define('COOKIE_DOMAIN', '');
define('COOKIEPATH', '');
define('SITECOOKIEPATH', '');
</code></pre>

<p><b>And we&rsquo;re done!</b> Visit your new multisite URL: [<a href="http://localhost/knowledgebase](">http://localhost/knowledgebase](</a>) and you should be good to go!</p>

<p><b>Note:</b> For adding more multisites, add a necessary rule in <b>Step 1</b> and update the necessary tables in <b>Step 2</b>.</p>

		</article>
	</section>
	<hr>
	<div id="disqus_thread"></div>
<script type="text/javascript">
(function() {
    	
      	
      	
     		
      	console.log('woooot');
      	var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      	var disqus_shortname = 'kunalnagar';
      	dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	</main>
	<input type="hidden" class="field-source-css" value="/css/main-36c4c60a.css">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" async></script>
<script type="text/javascript" src="/js/main-2c0c9164.js" async></script>
</body>
</html>