<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="description">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <title>Rewrite WordPress Multisites | Kunal Nagar</title>
    <meta name="robots" content="index, follow">
    <script>
        window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
        ga('create', 'UA-51202219-2', 'auto');
        ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
</head>
<body>
    <link href="https://fonts.googleapis.com/css?family=Noto+Serif:400,700" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/zenburn.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/base.css">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<nav id="navbar">
    <div class="container">
        <div class="navbar-brand">
            <a href="/" ><img src="/assets/img/logo-simple.svg" title="Hi." /></a>
        </div>
        <ul class="navbar-items">
            <!-- <li>
<a href="/projects" rel="noopener noreferrer" title="Projects" class="btn-link ">Projects</a>

</li> -->
            <li>
<a href="/assets/downloads/Résumé - Kunal Nagar.pdf" target="_blank" rel="noopener noreferrer" title="Résumé" class="btn-link ">Résumé</a>

</li>
            <li>
<a href="/blog" rel="noopener noreferrer" title="Blog" class="btn-link ">Blog</a>

</li>
            <li>
<a href="/about" rel="noopener noreferrer" title="About" class="btn-link ">About</a>

</li>
            <li>
<a href="/contact" rel="noopener noreferrer" title="Contact" class="btn-link ">Contact</a>

</li>
        </ul>
    </div>
</nav>

    <div class="page page-blog-single">
        <div class="container">
            <section class="section">
                <article class="blog-single">
                    <h1 class="blog-single--title">Rewrite WordPress Multisites</h1>
                    <p class="blog-single--posted">Sep 17, 2016</p>
                    <p>Recently, one of my tasks was to create a Blog and a Knowledge Base and use similar credentials and login-flows for both of their Admin Consoles. Without a doubt, <a href="https://codex.wordpress.org/Create_A_Network">WordPress Multisite</a> is the perfect choice for this since you don’t have to manage your Auth/Settings/Dashboard in multiple places.</p>

<p><i><b>Note:</b> Creating WordPress multisites is out of the scope of this article. For more info, check out <a href="https://codex.wordpress.org/Create_A_Network">this link</a>.</i></p>

<p>When you set up a WordPress Multisite install, you create one root site and then all other multisites are created as subfolders (children). For example, you may end up with something like:</p>

<pre><code class="shell">http://localhost/blog/ # Root Site
http://localhost/blog/knowledgebase/ # Multisite 1
http://localhost/blog/site/ # Multisite 2
</code></pre>

<p>As you can see, this is not ideal, you would ideally want something like this, i.e. each multisite at the same level as the root site (blog):</p>

<pre><code class="shell">http://localhost/blog/
http://localhost/knowledgebase/
http://localhost/site/
</code></pre>

<p>It turns out – you can easily do this in 3 steps:</p>

<h2 id="step-1-create-a-root-level-htaccess">Step 1: Create a root level .htaccess</h2>

<p>We need to intercept all request to multisites and then rewrite them to their original URLs.</p>

<p>Please note that this is NOT a redirect, but a rewrite. There’s a <a href="http://weblogs.asp.net/owscott/rewrite-vs-redirect-what-s-the-difference">difference</a>.</p>

<p>Moving along – create an .htaccess file in the root. If you’re using something like XAMPP, create it in the <b>htdocs</b> folder:</p>

<pre><code class="shell"># Root Level .htaccess

RewriteEngine On
RewriteBase /

# Redirect knowledgebase to knowledgebase/
RewriteRule knowledgebase$ knowledgebase/ [R=301,L]

# Intercept all requests coming to http://localhost/knowledgebase
RewriteCond %{REQUEST_URI} /knowledgebase

# Rewrite the intercepted requests to
# /knowledgebase/anything-here from /blog/knowledgebase/anything-here
RewriteRule ^knowledgebase/(.*) blog/knowledgebase/$1 [L]
</code></pre>

<h2 id="step-2-update-the-database">Step 2: Update the Database</h2>

<p>Just rewriting in the <b>.htaccess</b> is not going to cut it for us. There are some entries in the Database that we need to change:</p>

<pre><code class="sql">-- Update wp_blogs table to remove /blog from the path
UPDATE wp_blogs SET path="/knowledgebase/" WHERE path="/blog/knowledgebase/";

-- Update wp_SITE_ID_options siteurl to remove /blog in the URL
UPDATE wp_2_options SET option_value="http://localhost/knowledgebase" WHERE option_name="siteurl";

-- Update wp_SITE_ID_options home to remove /blog in the URL
UPDATE wp_2_options SET option_value="http://localhost/knowledgebase" WHERE option_name="home";
</code></pre>

<h2 id="step-3-handle-cookiessessions">Step 3: Handle cookies/sessions</h2>

<p>Now, we need to handle cookies/sessions since our URLs have changed. Paste the following lines in the <b>wp-config.php</b> file below the multisite lines:</p>

<pre><code class="php">define('ADMIN_COOKIE_PATH', '/');
define('COOKIE_DOMAIN', '');
define('COOKIEPATH', '');
define('SITECOOKIEPATH', '');
</code></pre>

<p><b>And we’re done!</b> Visit your new multisite URL: <a href="">http://localhost/knowledgebase</a> and you should be good to go!</p>

<p><b>Note:</b> For adding more multisites, add a necessary rule in <b>Step 1</b> and update the necessary tables in <b>Step 2</b>.</p>


                </article>
            </section>
        </div>
    </div>
    <script type="text/javascript">
    function async(u, c) {
        var d = document, t = 'script',
            o = d.createElement(t),
            s = d.getElementsByTagName(t)[0];
        o.src = '//' + u;
        if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
        s.parentNode.insertBefore(o, s);
    }
    async('platform.twitter.com/widgets.js', function() {});
    async('cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js', function() {
        hljs.configure({
            tabReplace: '    '
        });
        hljs.initHighlightingOnLoad();
    });
</script>

</body>
</html>
