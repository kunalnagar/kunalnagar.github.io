<html>
	<head>
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
		<link rel="icon" href="/favicon.ico" type="image/x-icon">
		<title>Rewrite WordPress Multisites</title>
		<!--Boilerplate-->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<meta name="description" content="Learn how to rewrite WordPress Multisites to any folder on your server.">
		<meta name="keywords" content="">
		<meta name="author" content="Kunal Nagar">

		<!-- Open Graph Tags Start -->
<meta property="og:title" content="Rewrite WordPress Multisites">

<meta property="og:type" content="website">

<meta property="og:url" content="http://kunalnagar.in/blog/rewrite-wordpress-multisites/">

<meta property="og:image" content="http://kunalnagar.in/img/blog/rewrite-wordpress-multisites/fb-rewrite-wordpress-multisites.jpg">

<meta property="og:description" content="Learn how to rewrite WordPress Multisites to any folder on your server.">

<meta property="og:site_name" content="Web Development & Design | Kunal Nagar">

<meta property="og:locale" content="en_US">


  
    <meta property="og:see_also" content="http://kunalnagar.in/blog/shared-modules-using-requirejs/">
  
    <meta property="og:see_also" content="http://kunalnagar.in/blog/github-style-copy-path-zeroclipboard/">
  
    <meta property="og:see_also" content="http://kunalnagar.in/blog/tripmode-mobile-data-savior/">
  


<meta property="fb:admins" content="https://www.facebook.com/kunalnagar88">
<meta property="fb:app_id" content="1761328640797363">
<!-- Open Graph Tags End -->

		<!-- Twitter Card Tags Start -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@_kunalnagar">
<meta name="twitter:creator" content="@_kunalnagar">
<meta name="twitter:title" content="Rewrite WordPress Multisites">
<meta name="twitter:description" content="Learn how to rewrite WordPress Multisites to any folder on your server.">
<meta name="twitter:image" content="http://kunalnagar.in/img/blog/rewrite-wordpress-multisites/twitter-rewrite-wordpress-multisites.jpg">
<!-- Twitter Card Tags End -->


		<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51202219-2', 'auto');
  ga('send', 'pageview');
</script>


		<!--Main CSS File-->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<link href='https://fonts.googleapis.com/css?family=Product+Sans:100,300,400,700' rel='stylesheet' type='text/css'>
		<link href="https://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="/css/style.css">

		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<nav id="main_nav" class="hidden-xs">
    <a href="/">
        <?xml version="1.0" encoding="UTF-8"?>
        <svg width="40px" height="40px" viewBox="0 0 40 40" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <!-- Generator: Sketch 43.2 (39069) - http://www.bohemiancoding.com/sketch -->
            <title>Home</title>
            <desc>Created with Sketch.</desc>
            <defs></defs>
            <g id="Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="Plain-Logo-3">
                    <g>
                        <rect id="Rectangle-1" fill="#000000" x="1.8189894e-12" y="-3.63797881e-12" width="39.9832387" height="39.9832387"></rect>
                        <text id="K" font-family="BrandonGrotesque-Medium, Brandon Grotesque" font-size="23.3810086" font-weight="400" fill="#FFFFFF">
                            <tspan x="12.2552603" y="29.0489356">K</tspan>
                        </text>
                    </g>
                </g>
            </g>
        </svg>
    </a>
</nav>

		<div id="main" class="container">
			<a href="/" class="text-center visible-xs logo-other-link"><img src="/img/logo-main.svg" class="logo-other" /></a>
			<div class="page-post page-outer">
			<header>
	            <h3>Rewrite WordPress Multisites</h3>
	            <time class="published post-meta">Sep 17, 2016</time>
	        </header>
			<p>Recently, one of my tasks was to create a Blog and a Knowledge Base and use similar credentials and login-flows for both of their Admin Consoles. Without a doubt, <a href="https://codex.wordpress.org/Create_A_Network">WordPress Multisite</a> is the perfect choice for this since you don’t have to manage your Auth/Settings/Dashboard in multiple places.</p>

<p><i><b>Note:</b> Creating WordPress multisites is out of the scope of this article. For more info, check out <a href="https://codex.wordpress.org/Create_A_Network">this link</a>.</i></p>

<p>When you set up a WordPress Multisite install, you create one root site and then all other multisites are created as subfolders (children). For example, you may end up with something like:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">http://localhost/blog/ <span class="c"># Root Site</span>
http://localhost/blog/knowledgebase/ <span class="c"># Multisite 1</span>
http://localhost/blog/site/ <span class="c"># Multisite 2</span></code></pre></figure>

<p>As you can see, this is not ideal, you would ideally want something like this, i.e. each multisite at the same level as the root site (blog):</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">http://localhost/blog/
http://localhost/knowledgebase/
http://localhost/site/</code></pre></figure>

<p>It turns out – you can easily do this in 3 steps:</p>

<h4 id="step-1-create-a-root-level-htaccess">Step 1: Create a root level .htaccess</h4>

<p>We need to intercept all request to multisites and then rewrite them to their original URLs.</p>

<p>Please note that this is NOT a redirect, but a rewrite. There’s a <a href="http://weblogs.asp.net/owscott/rewrite-vs-redirect-what-s-the-difference">difference</a>.</p>

<p>Moving along – create an .htaccess file in the root. If you’re using something like XAMPP, create it in the <b>htdocs</b> folder:</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Root Level .htaccess</span>

RewriteEngine On
RewriteBase /

<span class="c"># Redirect knowledgebase to knowledgebase/</span>
RewriteRule knowledgebase<span class="nv">$ </span>knowledgebase/ <span class="o">[</span><span class="nv">R</span><span class="o">=</span>301,L]

<span class="c"># Intercept all requests coming to http://localhost/knowledgebase</span>
RewriteCond %<span class="o">{</span>REQUEST_URI<span class="o">}</span> /knowledgebase

<span class="c"># Rewrite the intercepted requests to</span>
<span class="c"># /knowledgebase/anything-here from /blog/knowledgebase/anything-here</span>
RewriteRule ^knowledgebase/<span class="o">(</span>.<span class="k">*</span><span class="o">)</span> blog/knowledgebase/<span class="nv">$1</span> <span class="o">[</span>L]</code></pre></figure>

<h4 id="step-2-update-the-database">Step 2: Update the Database</h4>

<p>Just rewriting in the <b>.htaccess</b> is not going to cut it for us. There are some entries in the Database that we need to change:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">-- Update wp_blogs table to remove /blog from the path</span>
<span class="k">UPDATE</span> <span class="n">wp_blogs</span> <span class="k">SET</span> <span class="n">path</span><span class="o">=</span><span class="nv">"/knowledgebase/"</span> <span class="k">WHERE</span> <span class="n">path</span><span class="o">=</span><span class="nv">"/blog/knowledgebase/"</span><span class="p">;</span>

<span class="c1">-- Update wp_SITE_ID_options siteurl to remove /blog in the URL</span>
<span class="k">UPDATE</span> <span class="n">wp_2_options</span> <span class="k">SET</span> <span class="n">option_value</span><span class="o">=</span><span class="nv">"http://localhost/knowledgebase"</span> <span class="k">WHERE</span> <span class="n">option_name</span><span class="o">=</span><span class="nv">"siteurl"</span><span class="p">;</span>

<span class="c1">-- Update wp_SITE_ID_options home to remove /blog in the URL</span>
<span class="k">UPDATE</span> <span class="n">wp_2_options</span> <span class="k">SET</span> <span class="n">option_value</span><span class="o">=</span><span class="nv">"http://localhost/knowledgebase"</span> <span class="k">WHERE</span> <span class="n">option_name</span><span class="o">=</span><span class="nv">"home"</span><span class="p">;</span></code></pre></figure>

<h4 id="step-3-handle-cookiessessions">Step 3: Handle cookies/sessions</h4>

<p>Now, we need to handle cookies/sessions since our URLs have changed. Paste the following lines in the <b>wp-config.php</b> file below the multisite lines:</p>

<figure class="highlight"><pre><code class="language-php" data-lang="php">define('ADMIN_COOKIE_PATH', '/');
define('COOKIE_DOMAIN', '');
define('COOKIEPATH', '');
define('SITECOOKIEPATH', '');</code></pre></figure>

<p><b>And we’re done!</b> Visit your new multisite URL: <a href="">http://localhost/knowledgebase</a> and you should be good to go!</p>

<p><b>Note:</b> For adding more multisites, add a necessary rule in <b>Step 1</b> and update the necessary tables in <b>Step 2</b>.</p>


			<p class="share">
				<span><b>Share on:</b></span>
				<a href="https://twitter.com/intent/tweet?url=http://kunalnagar.in/blog/rewrite-wordpress-multisites/&amp;text=Rewrite WordPress Multisites&amp;via=_kunalnagar">Twitter</a>,
				<a href="https://facebook.com/sharer.php?u=http://kunalnagar.in/blog/rewrite-wordpress-multisites/">Facebook</a>,
				<a href="https://plus.google.com/share?url=http://kunalnagar.in/blog/rewrite-wordpress-multisites/">Google+</a>,
				<a href="https://www.linkedin.com/cws/share?url=http://kunalnagar.in/blog/rewrite-wordpress-multisites/">LinkedIn</a>
				or use the <a href="http://kunalnagar.in/blog/rewrite-wordpress-multisites/">Permalink</a>
			</p>
			<div id="disqus_thread"></div>
<script>
	var disqus_config = function () {
		this.page.url = "http://kunalnagar.in/blog/rewrite-wordpress-multisites/";
		this.page.identifier = "/blog/rewrite-wordpress-multisites/";
	};
	(function() {
		var d = document, s = d.createElement('script');
		s.src = '//kunalnagar.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

			</div>
			<!-- <script src="https://use.fontawesome.com/7dd3e58787.js"></script> -->
			<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
			<script src="/js/main.js"></script>
			<script id="dsq-count-scr" src="//kunalnagar.disqus.com/count.js" async></script>
		</div>
	</body>
</html>
