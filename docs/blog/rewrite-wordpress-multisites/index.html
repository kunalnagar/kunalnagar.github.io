<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Learn how to rewrite WordPress Multisites to any folder on your server.">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <title>Rewrite WordPress Multisites – Kunal Nagar</title>
    <meta property="og:image" content="https://kunalnagar.in/assets/img/post.png">
    <meta name="robots" content="index, follow">
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
</head>
<body>
    <main>
        <nav class="navbar">
    <div class="container l-container navbar-container">
        <section class="brand">
            <a href="/" class="link" title="Home">
                <img src="/assets/img/logo.png" class="img" alt="Kunal Nagar - Logo" />
                <span>Kunal Nagar</span>
            </a>
        </section>
        <section class="links">
            <ul>
                <li>
                    <a href="/assets/downloads/Resume_Kunal_Nagar.pdf" title="View professional journey">Résumé</a>
                </li>
                <li>
                    <a href="/foss" title="View open source work">Open Source</a>
                </li>
                <li>
                    <a href="/blog" title="Read blog">Blog</a>
                </li>
            </ul>
        </section>
    </div>
</nav>

        <div class="container l-container p-blog-single">
            <section class="section header">
                <img src="/assets/img/foss/wp.png" class="img" />
                <div>
                    <h1 class="section-heading title">Rewrite WordPress Multisites</h1>
                    <div class="l-flex l-items-center">
                        <time class="date">September 17, 2016</time>
                        <span class="breadcrumb-separator">/</span>
                        <a href="http://twitter.com/share?text=Rewrite WordPress Multisites&url=/blog/rewrite-wordpress-multisites/&via=_kunalnagar" class="btn-share" title="Share on Twitter" target="_blank" rel="noopener noreferrer">
                            Share
                        </a>
                    </div>
                </div>
            </section>
            <section class="section content"><p>Recently, one of my tasks was to create a Blog and a Knowledge Base and use similar credentials and login-flows for both of their Admin Consoles. Without a doubt, <a href="https://codex.wordpress.org/Create_A_Network">WordPress Multisite</a> is the perfect choice for this since you don’t have to manage your Auth/Settings/Dashboard in multiple places.</p>

<p><i><b>Note:</b> Creating WordPress multisites is out of the scope of this article. For more info, check out <a href="https://codex.wordpress.org/Create_A_Network">this link</a>.</i></p>

<p>When you set up a WordPress Multisite install, you create one root site and then all other multisites are created as subfolders (children). For example, you may end up with something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost/blog/ # Root Site
http://localhost/blog/knowledgebase/ # Multisite 1
http://localhost/blog/site/ # Multisite 2
</code></pre></div></div>

<p>As you can see, this is not ideal, you would ideally want something like this, i.e. each multisite at the same level as the root site (blog):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://localhost/blog/
http://localhost/knowledgebase/
http://localhost/site/
</code></pre></div></div>

<p>It turns out – you can easily do this in 3 steps:</p>

<h2 id="step-1-create-a-root-level-htaccess">Step 1: Create a root level .htaccess</h2>

<p>We need to intercept all request to multisites and then rewrite them to their original URLs.</p>

<p>Please note that this is NOT a redirect, but a rewrite. There’s a <a href="http://weblogs.asp.net/owscott/rewrite-vs-redirect-what-s-the-difference">difference</a>.</p>

<p>Moving along – create an .htaccess file in the root. If you’re using something like XAMPP, create it in the <b>htdocs</b> folder:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Root Level .htaccess

RewriteEngine On
RewriteBase /

# Redirect knowledgebase to knowledgebase/
RewriteRule knowledgebase$ knowledgebase/ [R=301,L]

# Intercept all requests coming to http://localhost/knowledgebase
RewriteCond %{REQUEST_URI} /knowledgebase

# Rewrite the intercepted requests to
# /knowledgebase/anything-here from /blog/knowledgebase/anything-here
RewriteRule ^knowledgebase/(.*) blog/knowledgebase/$1 [L]
</code></pre></div></div>

<h2 id="step-2-update-the-database">Step 2: Update the Database</h2>

<p>Just rewriting in the <b>.htaccess</b> is not going to cut it for us. There are some entries in the Database that we need to change:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- Update wp_blogs table to remove /blog from the path
UPDATE wp_blogs SET path="/knowledgebase/" WHERE path="/blog/knowledgebase/";

-- Update wp_SITE_ID_options siteurl to remove /blog in the URL
UPDATE wp_2_options SET option_value="http://localhost/knowledgebase" WHERE option_name="siteurl";

-- Update wp_SITE_ID_options home to remove /blog in the URL
UPDATE wp_2_options SET option_value="http://localhost/knowledgebase" WHERE option_name="home";
</code></pre></div></div>

<h2 id="step-3-handle-cookiessessions">Step 3: Handle cookies/sessions</h2>

<p>Now, we need to handle cookies/sessions since our URLs have changed. Paste the following lines in the <b>wp-config.php</b> file below the multisite lines:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>define('ADMIN_COOKIE_PATH', '/');
define('COOKIE_DOMAIN', '');
define('COOKIEPATH', '');
define('SITECOOKIEPATH', '');
</code></pre></div></div>

<p><b>And we’re done!</b> Visit your new multisite URL: <a href="">http://localhost/knowledgebase</a> and you should be good to go!</p>

<p><b>Note:</b> For adding more multisites, add a necessary rule in <b>Step 1</b> and update the necessary tables in <b>Step 2</b>.</p>

</section>
        </div>
        <footer>
    <script src="/assets/js/main.js" async defer></script>
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-51202219-2']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</footer>

    </main>
</body>
</html>
